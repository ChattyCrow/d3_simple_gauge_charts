/*
D3 simple gauge chart based on radialProgress on BrightPoint Consulting, Inc. example for gauge charts in d3.
 */
(function(){var t=[].slice
!function(r,e){var a
return a=function(){function t(e,a){this.$el=r(e),this.options=r.extend({},this.defaults,a,this.$el.data()),this._arc=d3.svg.arc().startAngle(0*t.DEG_TO_RAD),this._arcLines=d3.svg.arc(),this._arcRedPoint=d3.svg.arc(),this.options.circle/=2,this.draw()}return t.prototype.defaults={duration:1e3,value:50,margin:{top:0,right:0,bottom:30,left:0},showHoverClass:"showHover",hideHoverClass:"hideHover",width:170,height:140,circle:180,diameter:200,primaryLabelText:function(t){return Math.round(t)+"%"},primaryLabelTextHover:"",secondaryLabelText:"",secondaryLabelTextHover:"",grayLines:5,spaceBetweenGrayLines:7,startColor:"#f9a535",stopColor:"#f48e07",primaryFontSize:34,secondaryFontSize:10},t.MIN_VALUE=0,t.MAX_VALUE=100,t.DEG_TO_RAD=Math.PI/90,t.prototype._currentArc=0,t.prototype._currentValue=0,t.prototype._arc=null,t.prototype._arcLines=null,t.prototype._arcRedPoint=null,t.prototype._svg=null,t.prototype._myPath=null,t.prototype._rad=72,t.prototype.meassure=function(){var t,r,e
return t=this.options.margin,this.options.width=this.options.diameter-t.right-t.left-t.top-t.bottom,this.options.height=this.options.width,this.options.fontSize=.2*this.options.width,r=this.options.width/2.3,e=this.options.width/2.339,this._arc.outerRadius(r),this._arc.innerRadius(.97*r),this._arcLines.outerRadius(r),this._arcLines.innerRadius(.97*r),this._arcRedPoint.outerRadius(e),this._arcRedPoint.innerRadius(.97*e)},t.prototype.createGradient=function(){return this._svgDefs=this._svg.append("svg:defs"),this._gradient=this._svgDefs.append("svg:linearGradient").attr("id",Math.random()).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%"),this._gradient.append("svg:stop").attr("offset","0%").attr("stop-color",this.options.startColor).attr("stop-opacity",1),this._gradient.append("svg:stop").attr("offset","100%").attr("stop-color",this.options.stopColor).attr("stop-opacity",1)},t.prototype.createBackground=function(){var t,r,e,a,i
return e=this.options,this._background=this._svg.append("g").attr("class","component"),this._background.append("rect").attr("class","background").attr("width",this.options.width).attr("height",this.options.height),r=e.width/2,a=this._svg.append("g").attr("class","primaryLabels"),e.primaryLabelText&&(this._label=a.append("text").attr("class","primaryLabel "+(e.primaryLabelTextHover?e.hideHoverClass:"")).attr("y",r+e.primaryFontSize/3).attr("x",r).attr("width",e.width).text(e.primaryLabelText).style("font-size",e.primaryFontSize)),e.primaryLabelTextHover&&a.append("text").attr("class","primaryLabel showHover").attr("y",r+e.primaryFontSize/3).attr("x",r).attr("width",e.width).text(e.primaryLabelTextHover).style("font-size",e.primaryFontSize),t=e.primaryFontSize+5,i=this._svg.append("g").attr("class","secondaryLabels"),e.secondaryLabelText&&i.append("text").attr("class","secondaryLabel "+(e.secondaryLabelTextHover?e.hideHoverClass:"")).attr("transform","translate("+r+", "+(r+t)+")").text(e.secondaryLabelText),e.secondaryLabelTextHover?i.append("text").attr("class","secondaryLabelHover "+e.showHoverClass).attr("transform","translate("+r+", "+(r+t)+")").text(e.secondaryLabelTextHover):void 0},t.prototype.drawGrayLines=function(){var r,e,a,i,s,n,o,p,h,l
for(n=this._svg.append("g").attr("class","gray_lines"),l=90===this.options.circle?1:0,s=(this.options.circle-(this.options.grayLines-l)*this.options.spaceBetweenGrayLines)/this.options.grayLines,e=this.options.width/2,p=[],a=i=0,o=this.options.grayLines-1;o>=0?o>=i:i>=o;a=o>=0?++i:--i)h=a*s+a*this.options.spaceBetweenGrayLines,r=(a+1)*s+a*this.options.spaceBetweenGrayLines,this._arcLines.startAngle(h*t.DEG_TO_RAD),this._arcLines.endAngle(r*t.DEG_TO_RAD),p.push(n.append("path").attr("transform","translate("+e+", "+e+"), rotate(-90)").attr("fill","none").attr("stroke","lightgray").attr("stroke-width","3").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("d",this._arcLines))
return p},t.prototype.drawPath=function(){var t,r
return this._svg.append("g").attr("class","arcs"),r=this.options.width/2,t=this._gradient.attr("id"),this._arc.endAngle(this._currentArc),this._path=this._svg.select(".arcs").selectAll(".arc").data([1]),this._path.enter().append("path").attr("class","arc").attr("transform","translate("+r+", "+r+"), rotate(-90)").attr("fill","none").attr("stroke","url(#"+t+")").attr("stroke-width","12").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("d",this._arc)},t.prototype.draw=function(){var r,e,a
return a=this,this._svg=d3.select(this.$el.get(0)).selectAll("svg").data([1]),this._enter=this._svg.enter().append("svg").attr("class","radial-svg d3SimpleGauge"),this.meassure(),this._svg.attr("width",this.options.width).attr("height",this.options.height),this.createGradient(),this.createBackground(),Number.parseInt(this.options.grayLines)&&this.drawGrayLines(),this.drawPath(),e=this.options.value/100,r=Math.min(this.options.circle*e,this.options.circle),r*=t.DEG_TO_RAD,this._path.exit().transition().duration(500).attr("x",1e3).remove(),this._path.datum(r),this._path.transition().duration(this.options.duration).attrTween("d",function(t){return a.arcTween(t)}),this.options.primaryLabelText&&this.options.primaryLabelText.call&&this.options.primaryLabelText.apply?(this._label.datum(Math.round(100*e)),this._label.transition().duration(this.options.duration).tween("text",function(t){return a.arcLabelTween(t)})):void 0},t.prototype.arcTween=function(t){var r,e
return e=this,r=d3.interpolate(e._currentArc,t),function(t){return e._currentArc=r(t),e._arc.endAngle(r(t))()}},t.prototype.arcLabelTween=function(t){var r,e,a
return a=this,e=d3.interpolate(a._currentValue,t),r=e(0),function(t){return a._currentValue=e(t),this.textContent=a.options.primaryLabelText(e(t))}},t}(),r.fn.d3SimpleGauge=function(){var e,i
return i=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],this.each(function(){var t,s
return t=r(this),s=t.data("d3SimpleGauge"),s||t.data("d3SimpleGauge",s=new a(this,i)),"string"==typeof i?s[i].apply(s,e):void 0})}}(window.jQuery,window)}).call(this)
